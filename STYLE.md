# Visual Style Specification

## Overview

Two-pass composite rendering with cartoon/ribbon molecular styles. The ribosome renders as a cartoon with a blue outline (dilated silhouette), while mRNA, tRNAs, and polypeptide render as cartoon/ribbon representations with emission for visibility. Per-frame OpenMM thermal motion provides physically realistic molecular breathing.

## Rendering approach: 2-pass composite

Two Cycles render passes composited per frame in `animate.py`:

1. **Pass 1 (ribosome):** Ribosome cartoon only → extract silhouette → dilate for outline
2. **Pass 2 (internals):** mRNA, tRNAs, polypeptide rendered with cartoon/ribbon styles

The outline is generated by binary dilation of the ribosome silhouette, subtracted from the original to get an edge mask, then colorized (pale blue) and composited behind the internal molecules.

Previous approach (v4-v5): single-pass StyleSurface with shader transparency — abandoned because per-residue vertex deformation tears surface meshes at residue boundaries.

## Ribosome (40S + 60S subunits)

- **Representation:** Cartoon style
- **Color:** Uniform pale blue-gray
- **Outline:** Dilated silhouette (3px), pale blue (70, 120, 200)
- **Thermal motion:** Pre-computed ENM trajectory (456 frames, 16938 residues)
- **No per-chain coloring** — uniform across all subunits

## Internal components (mRNA, tRNAs, polypeptide)

- **mRNA:** Cartoon style, vibrant blue, per-frame OpenMM thermal motion
- **tRNAs:** Ribbon style, vibrant orange, per-frame OpenMM thermal motion
- **Polypeptide:** Cartoon style, magenta/purple, domain folding morph + gradient scroll
- **Material:** Principled BSDF with emission for visibility through ribosome outline
- **Thermal motion:** OpenMM elastic network MD (k=100 kJ/mol/nm², T=310K, 500 steps/frame)

### Per-component colors

| Component | Chain(s) | Color |
|-----------|----------|-------|
| mRNA | A4 | Vibrant blue |
| tRNAs | B4 | Vibrant orange |
| Nascent polypeptide | C4 + extension | Magenta / purple |

## Background

- Dark charcoal (0.04, 0.04, 0.06), low world strength (~0.5)

## Lighting

- Cycles default + world background. Soft, even.
- Emission on internal molecules (strength ~0.8) for self-illumination through translucent ribosome.

## Thermal motion parameters

```python
# OpenMM elastic network MD
MD_SPRING_CONSTANT = 100.0  # kJ/mol/nm²
MD_TEMPERATURE = 310        # K
MD_STEPS_PER_FRAME = 500

# Ribosome ENM trajectory
RIBOSOME_THERMAL_FRAMES = 456
RIBOSOME_THERMAL_RESIDUES = 16938

# Outline compositing
OUTLINE_COLOR = (70, 120, 200)  # pale blue
OUTLINE_THICKNESS = 3           # pixels (binary dilation radius)
```
